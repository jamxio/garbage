!function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){var t=e.username,o=e.password;return!t||t.length<3?void e.toast("用户名太短"):!t||t.length>25?void e.toast("用户名太长"):!o||o.length<4?void e.toast("请输入正确的密码"):void a.auth.base.signin({username:t,password:o}).then(function(t){t?(e.toast("登录成功"),e.goHome()):e.toast("用户名或密码错误")})}function l(){r.go("signup",{})}function d(){r.go("forget",{})}function p(){r.go("wechat-auth",{})}function h(){r.go("qq-auth",{})}function f(){var e=s.getConfig(),t=e["wechat.web"];return t&&i.isWeixin()}e.username="",e.password="",e.touchSignin=u,e.touchSignup=l,e.touchForget=d,e.touchWeixin=p,e.touchQQ=h,e.isWeixin=f}angular.module("app").controller("SigninController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","ENUM","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("signin",{needAuth:!1,url:"/signin",title:"用户登录",templateUrl:"modules/signin/signin.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.currentTab!=e.TAB_MOBILE&&(e.currentTab=e.TAB_MOBILE,e.signupMobile={show:!0})}function d(){e.currentTab!=e.TAB_EMAIL&&(e.currentTab=e.TAB_EMAIL,e.signupMobile={show:!1})}function p(){var t=e.state.username,o=e.state.password,n=e.state.password2,r=e.state.email;if(!t||t.length<3)return void e.toast("用户名太短");if(!t||t.length>25)return void e.toast("用户名太长");if(!o||o.length<6)return void e.toast("请输入正确的密码");if(o!=n)return e.toast("请输入正确的密码"),void(e.password2="");if(!r||r.length<5)return void e.toast("请输入正确的邮箱地址");var i={};i.username=t,i.password=o,i.email=r,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth["default"].signup(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("注册成功"),e.goHome()):e.toast(t.data.error_desc)})}function h(){var t=60,o=void 0;o=u(function(){0>=t?(u.cancel(o),o=void 0,t=60,e.paracont="重发验证码",e.paraclass="mobile-code",e.paraevent=!0):(e.paracont=t+"s",e.paraclass="not-mobile-code",e.paraevent=!1,t--)},1e3,100)}function f(){if(e.paraevent){var t=e.state.mobile;if(!t||t.length<1)return void e.toast("请输入手机号码");var o={};o.mobile=t,o.code="86",a.auth.mobile.verify(o).then(function(t){t&&a.auth.mobile.send(o).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?h():e.toast(t.data.error_desc)})})}}function g(){var t=e.state.mobile,o=e.state.mobile_code,n=e.state.mobile_password,r=e.state.mobile_password2;if(!t||t.length<1)return void e.toast("请输入手机号码");if(!o||6!=o.length)return void e.toast("请输入正确的手机验证码");if(!n||n.length<6)return void e.toast("请输入正确的密码");if(n!=r)return e.toast("请输入正确的密码"),void(e.password2="");var i={};i.mobile=t,i.code=o,i.password=n,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth.mobile.signup(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("手机号注册成功"),e.goHome()):e.toast(t.data.error_desc)})}function m(){o.location.href=e.siteInfo.terms_url}function v(){a.site.get().then(function(t){e.siteInfo=t})}e.TAB_MOBILE=0,e.TAB_EMAIL=1,e.currentTab=e.TAB_MOBILE,"mobile"==i.tab?e.currentTab=e.TAB_MOBILE:"email"==i.tab?e.currentTab=e.TAB_EMAIL:e.currentTab=e.TAB_MOBILE,e.touchTabMobile=l,e.touchTabEmail=d,e.signupMobile={show:!0},e.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},e.touchSignup=p,e.touchSignupMobile=g,e.toucheMobileCode=f,e.touchLicense=m,e.siteInfo={},e.paracont="获取验证码",e.paraclass="mobile-code",e.paraevent=!0,v()}angular.module("app").controller("SignupController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function e(e,t){e.state("signup",{needAuth:!1,url:"/signup",title:"用户注册",templateUrl:"modules/signup/signup.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.currentTab!=e.TAB_MOBILE&&(e.currentTab=e.TAB_MOBILE,e.forgetMobile={show:!0})}function d(){e.currentTab!=e.TAB_EMAIL&&(e.currentTab=e.TAB_EMAIL,e.forgetMobile={show:!1})}function p(){var t=60,o=void 0;o=u(function(){0>=t?(u.cancel(o),o=void 0,t=60,e.paracont="重发验证码",e.paraclass="mobile-code",e.paraevent=!0):(e.paracont=t+"s",e.paraclass="not-mobile-code",e.paraevent=!1,t--)},1e3,100)}function h(){if(e.paraevent){var t=e.state.mobile;if(!t||t.length<1)return void e.toast("请输入手机号码");var o={};o.mobile=t,o.code="86",a.auth.mobile.send(o).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?p():e.toast(t.data.error_desc)})}}function f(){var t=e.state.mobile,o=e.state.mobile_code,n=e.state.mobile_password,r=e.state.mobile_password2;if(!t||t.length<1)return void e.toast("请输入手机号码");if(!o||6!=o.length)return void e.toast("请输入正确的手机验证码");if(!n||n.length<6)return void e.toast("请输入正确的密码");if(n!=r)return e.toast("请输入正确的密码"),void(e.password2="");var i={};i.mobile=t,i.code=o,i.password=n,s.getReferences()&&(i.invite_code=parseInt(s.getReferences())),a.auth.mobile.reset(i).then(function(t){t.data&&c.ERROR_CODE.OK==t.data.error_code?(e.toast("找回密码成功"),e.goBack()):e.toast(t.data.error_desc)})}function g(){var t=e.input.email;return!t||t.length<4?void e.toast("请输入正确的邮箱"):void a.auth["default"].reset({email:t}).then(function(o){var n=c.ERROR_CODE.OK==o.data.error_code;e.success=n,n?e.email=t:e.toast(o.data.error_desc)})}function m(){e.goBack()}e.TAB_MOBILE=0,e.TAB_EMAIL=1,e.currentTab=e.TAB_MOBILE,"mobile"==i.tab?e.currentTab=e.TAB_MOBILE:"email"==i.tab?e.currentTab=e.TAB_EMAIL:e.currentTab=e.TAB_MOBILE,e.touchTabMobile=l,e.touchTabEmail=d,e.toucheMobileCode=h,e.touchforgetMobile=f,e.touchBackLogin=m,e.forgetMobile={show:!0},e.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},e.paracont="获取验证码",e.paraclass="mobile-code",e.paraevent=!0,e.success=!1,e.email="",e.input={email:""},e.touchSendMail=g}angular.module("app").controller("ForgetController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}(),function(){"use strict";function e(e,t){e.state("forget",{needAuth:!1,url:"/forget",title:"找回密码",templateUrl:"modules/forget/forget.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){i.go("search",{})}function f(t){return t.link&&t.link.length?void(u.location.href=t.link):void e.toast("没有链接")}function g(e){var t="";t=-1==e.url.indexOf("http://",0)?"http://"+e.url:e.url,u.location.href=t}function m(e){i.go("home",{})}function v(e){i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:null,category:e.id,navTitle:e.name,navStyle:"default"})}function $(e){i.go("product",{product:e.id})}function y(){a.banner.list({page:1,per_page:L}).then(function(t){e.banners=t;n(function(){e.bannerSwiper=new Swiper(".home-banner",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)})}function A(e){var t=Math.round((new Date).getTime()/1e3);return-1==e.indexOf("?")?e+"?v="+t:e+"&v="+t}function T(){a.notice.list({page:1,per_page:b}).then(function(t){e.notices=t;n(function(){e.noticeSwiper=new Swiper(".notice-slide",{spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,direction:"vertical",loop:!0})},1)})}function E(){a.product.homeList().then(function(t){e.newArrival=t.recently_products,e.topSale=t.hot_products,e.editorChoice=t.good_products})}function S(){y(),T(),E(),p.fetch().then(function(){var e=p.getConfig(),t=e["wechat.web"];return t&&s.FOR_WEIXIN&&!l.getOpenId()&&o.isWeixin()?void i.go("wechat-authbase",{}):void _()}),e.cartModel.reloadIfNeeded()}function w(){}function M(e,t){if(e){wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:e.app_id,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]});var n=t;wx.ready(function(){wx.onMenuShareTimeline({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"推荐分成",desc:"",link:n,imgUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(e))})}}function _(){l.getToken()&&a.bonus.get().then(function(e){p.fetch().then(function(){var t=p.getConfig();if(t){var o=t["wxpay.web"];o&&M(o,e.shared_link)}return!0})})}var L=10,b=5,P=4;e.banners=[],e.notices=[];for(var C={},I=[],R=0;P>R;++R)I.push(C);e.topSale=I,e.newArrival=I,e.editorChoice=I,e.touchSearch=h,e.touchBanner=f,e.touchNotice=g,e.touchCategory=v,e.touchProduct=$,e.touchGroup=m,e.formatUrl=A,e.reload=S,e.loadMore=w,e.cartModel=d,e.refreshCode=function(){Math.round((new Date).getTime()/1e3)},S()}angular.module("app").controller("HomeController",e),e.$inject=["$scope","$http","$rootScope","$timeout","$location","$state","API","ENUM","CONSTANTS","$window","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("index",{needAuth:!1,url:"?token",title:"首页",templateUrl:"modules/home/home.html"}),e.state("home",{needAuth:!1,url:"/home",title:"首页",templateUrl:"modules/home/home.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){function c(){n.go("search",{})}function s(t){e.selectedSide=t,e.subCategories=t.categories}function u(t){if(t)n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:t.id,title:t.name,navTitle:t.name,navStyle:"default"});else{var o=e.selectedSide;n.go("search-result",{sortKey:i.SORT_KEY.DEFAULT,sortValue:i.SORT_VALUE.DEFAULT,keyword:null,category:o.id,navTitle:o.name,title:o.name,navStyle:"default"})}}function l(){r.category.list({page:1,per_page:p}).then(function(t){t&&t.length?(e.categories=t,e.selectedSide=t[0],e.subCategories=t[0].categories):(e.categories=null,e.selectedSide=null,e.subCategories=null)})}function d(){l()}var p=1e3;e.categories=[],e.selectedSide=null,e.touchSearch=c,e.touchSide=s,e.touchMain=u,e.cartModel=a,d()}angular.module("app").controller("CategoryController",e),e.$inject=["$scope","$http","$location","$state","API","ENUM","CartModel"]}(),function(){"use strict";function e(e,t){e.state("category",{needAuth:!1,url:"/category",title:"商品分类",templateUrl:"modules/category/category.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){var e=0;if(this.groups)for(var t=this.groups,o=0;o<t.length;++o)for(var n=t[o],r=0;r<n.goods.length;++r)e+=Number(n.goods[r].amount);this.total=e}function u(e,t,o){if(i.getToken()){var n=this;return a.cart.add({product:e,property:JSON.stringify(t),amount:o}).then(function(e){return e&&n.reload(),e})}}function l(e){if(i.getToken()){var t=this;return a.cart["delete"]({good:e}).then(function(o){if(o){for(var n=t.groups,r=0;r<n.length;++r)for(var i=n[r],a=0;a<i.goods.length;++a){var c=i.goods[a];if(c.id==e){i.goods.splice(a,1);break}}t.isEmpty=!t.groups||!t.groups.length,t.count()}return o})}}function d(e,t){if(i.getToken()){var o=this;return a.cart.update({good:e,amount:t}).then(function(n){if(n){for(var r=o.groups,i=0;i<r.length;++i)for(var a=r[i],c=0;c<a.goods.length;++c){var s=a.goods[c];if(s.id==e){s.amount=t;break}}o.isEmpty=!o.groups||!o.groups.length,o.count()}return n})}}function p(){if(!i.getToken())return this.total=0,void(f.total=0);var e=this;return a.cart.get({}).then(function(t){return t&&(e.groups=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1,e.count()),a.order.subtotal().then(function(t){e.subtotal=t}),!!t})}function h(){this.reload()}var f={};return f.isEmpty=!1,f.isLoaded=!1,f.isLoading=!1,f.isLastPage=!1,f.total=0,f.subtotal={},f.groups=null,f.count=s,f.add=u,f["delete"]=l,f.update=d,f.reload=p,f.reloadIfNeeded=h,f}angular.module("app").factory("CartModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(t){e.deletingGoods=t,e.showDialog=!0}function c(){e.showDialog=!1,e.deletingGoods=null}function s(){e.deletingGoods&&e.cartModel["delete"](e.deletingGoods.id).then(function(t){if(t){for(var o=e.selectedGoods,n=0;n<o.length;++n){var r=o[n];if(r.id==e.deletingGoods.id){o.splice(n,1);break}}e.toast("删除成功"),e.showDialog=!1,e.deletingGoods=null,m()}})}function u(e){n.go("product",{product:e.id})}function l(){return e.selectedGoods&&e.selectedGoods.length?(r.clear(),r.goods=e.selectedGoods,void n.go("confirm-cart",{})):void e.toast("请先选择商品")}function d(t){e.cartModel.update(t.id,Number(t.amount)+1).then(function(e){m()})}function p(t){t.amount<=1||e.cartModel.update(t.id,Number(t.amount)-1).then(function(e){m()})}function h(t){for(var o=e.selectedGoods,n=-1,r=0;r<o.length;++r){var i=o[r];if(i.id==t.id){n=r;break}}-1==n?o.push(t):o.splice(n,1),m()}function f(){var t=e.cartModel.groups,o=[],n=!e.isSelectedAll;if(n)for(var r=0;r<t.length;++r)for(var i=t[r],a=0;a<i.goods.length;++a){var c=i.goods[a];o.push(c)}e.selectedGoods=o,e.isSelectedAll=n,m()}function g(t){for(var o=e.selectedGoods,n=0;n<o.length;++n)if(t.id==o[n].id)return!0;return!1}function m(){for(var t=0,o=0,n=e.selectedGoods,r=0;r<n.length;++r)t+=Number(n[r].amount),o+=n[r].amount*n[r].price;e.selectedAmount=t,e.selectedPrice=o}function v(){e.cartModel.reload()}e.showDialog=!1,e.deletingGoods=null,e.touchDelete=a,e.touchDialogCancel=c,e.touchDialogConfirm=s,e.touchProduct=u,e.touchSubmit=l,e.touchAmountSub=p,e.touchAmountAdd=d,e.touchSelect=h,e.touchSelectAll=f,e.isSelected=g,e.isSelectedAll=!1,e.selectedGoods=[],e.selectedAmount=0,e.selectedPrice=0,e.cartModel=i,v()}angular.module("app").controller("CartController",e),e.$inject=["$scope","$http","$location","$state","ConfirmCartService","CartModel"]}(),function(){"use strict";function e(e,t){e.state("cart",{needAuth:!0,url:"/cart",title:"购物车",templateUrl:"modules/cart/cart.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t){e.state("cart-select",{needAuth:!0,url:"/cart-select",title:"购物车",templateUrl:"modules/cart-select/cart-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){r.go("my-order",{tab:"all"})}function l(){r.go("my-order",{tab:"created"})}function d(){r.go("my-order",{tab:"paid"})}function p(){r.go("my-order",{tab:"delivering"})}function h(){r.go("my-order",{tab:"delivered"})}function f(){r.go("my-favorite",{})}function g(){r.go("my-address",{})}function m(){r.go("my-score",{tab:"all"})}function v(){r.go("my-cashgift",{})}function $(){r.go("article",{})}function y(){r.go("change-password",{})}function A(){a.getToken()||e.goSignin()}function T(){a.getToken()&&i.auth.base.signout().then(function(t){t?(e.goHome(),e.toast("注销成功")):e.toast("注销失败")})}function E(){L()&&i.user.profileGet().then(function(t){a.setUser(t),e.user=t,t.nickname?e.userName=t.nickname:e.userName=t.username})}function S(){E(),e.cartModel.reloadIfNeeded()}function w(){return o.isWeixin()}function M(){r.go("bonus",{})}function _(){r.go("my-balance",{})}function L(){return a.getToken()}e.touchAllOrders=u,e.touchOrderCreated=l,e.touchOrderPayed=d,e.touchOrderDelivering=p,e.touchOrderDelivered=h,e.touchFav=f,e.touchAddress=g,e.touchScore=m,e.touchCashGift=v,e.touchHelps=$,e.touchPassword=y,e.touchSignin=A,e.touchSignout=T,e.touchBonus=M,e.touchBalance=_,e.isSignIn=L,e.isWeixin=w,e.cartModel=c,e.user=a.getUser(),e.userName="",s.fetch();var b=s.getConfig();e.authorize=b.authorize,S()}angular.module("app").controller("ProfileController",e),e.$inject=["$scope","$http","$rootScope","$location","$state","API","AppAuthenticationService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("profile",{needAuth:!0,url:"/profile",title:"个人中心",templateUrl:"modules/profile/profile.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){this.history=null}var c={};return c.history=null,c.clear=a,i.$on("searchChanged",function(e,t){if(t&&t.length){var o=c.history?c.history.indexOf(t):-1;-1==o&&(c.history=c.history||[],c.history.push(t))}}),c}angular.module("app").factory("SearchService",e),e.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){return!e.currentKeyword||e.currentKeyword.length<1?void e.toast("请输入正确的关键字"):(r.$emit("searchChanged",e.currentKeyword),void i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:e.currentKeyword,category:null,navTitle:e.currentKeyword,navStyle:"search"}))}function l(t){return!t||t.length<1?void e.toast("请输入正确的关键字"):(e.currentKeyword=t,r.$emit("searchChanged",t),void i.go("search-result",{sortKey:c.SORT_KEY.DEFAULT,sortValue:c.SORT_VALUE.DEFAULT,keyword:t,category:null,navTitle:t,navStyle:"search"}))}function d(){a.search.keywordList({}).then(function(t){e.keywords=t})}function p(){d()}e.currentKeyword="",e.keywords=null,e.history=s.history,e.touchSearch=u,e.touchKeyword=l,p()}angular.module("app").controller("SearchController",e),e.$inject=["$scope","$http","$window","$timeout","$rootScope","$state","API","ENUM","SearchService"]}(),function(){"use strict";function e(e,t){e.state("search",{needAuth:!1,url:"/search",title:"搜索",templateUrl:"modules/search/search.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){v()}function d(){var t=u.SORT_KEY.DEFAULT,o=u.SORT_VALUE.DEFAULT;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,v())}function p(){var t=u.SORT_KEY.SALE,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,v())}function h(){var t=u.SORT_KEY.DATE,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,v())}function f(){var t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC;e.currentSortKey==u.SORT_KEY.PRICE?e.currentSortValue==u.SORT_VALUE.DEFAULT||e.currentSortValue==u.SORT_VALUE.ASC?(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC):(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.ASC):(t=u.SORT_KEY.PRICE,o=u.SORT_VALUE.DESC),t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,v())}function g(){var t=u.SORT_KEY.CREDIT,o=u.SORT_VALUE.DESC;t==e.currentSortKey&&o==e.currentSortValue||(e.currentSortKey=t,e.currentSortValue=o,v())}function m(e){a.go("product",{product:e.id})}function v(){e.isLoading||(e.products=null,e.isEmpty=!1,e.isLoaded=!1,A(1,T))}function y(){if(!e.isLoading&&!e.isLastPage)if(e.products&&e.products.length){if(e.products.length%10)return;A(e.products.length/T+1,T)}else A(1,T)}function A(t,o){e.isLoading=!0;var n={};e.currentCategory&&(n.category=e.currentCategory),e.currentKeyword&&(n.keyword=e.currentKeyword),n.sort_key=e.currentSortKey,n.sort_value=e.currentSortValue,n.page=t,n.per_page=o,s.product.list(n).then(function(t){e.products=e.products?e.products.concat(t):t,e.isEmpty=!e.products||!e.products.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=t&&t.length<o?!e.isEmpty:!1})}var T=10;e.currentSortKey=c.sortKey?c.sortKey:u.SORT_KEY.DEFAULT,e.currentSortValue=c.sortValue?c.sortValue:u.SORT_KEY.DESC,e.currentKeyword=c.keyword?c.keyword:null,e.currentCategory=c.category,e.navTitle=c.navTitle,e.navStyle=c.navStyle,e.navStyle||(e.navStyle="default"),e.products=null,e.touchSearch=l,e.touchSortDefault=d,e.touchSortSale=p,e.touchSortDate=h,e.touchSortPrice=f,e.touchSortCredit=g,e.touchProduct=m,e.loadMore=y,e.isEmpty=!1,e.isLoaded=!1,e.isLoading=!1,e.isLastPage=!1,r.height&&$("html, body").animate({scrollTop:r.height},500),v()}angular.module("app").controller("SearchResultController",e),e.$inject=["$scope","$http","$window","$timeout","SearchResultModel","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("search-result",{needAuth:!1,url:"/search-result/?keyword&sortKey&sortValue&category&navTitle&navStyle",title:"搜索结果",templateUrl:"modules/search-result/search-result.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){var s={};return s.height=0,s.products=[],s}angular.module("app").factory("SearchResultModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){if(w()&&e.product&&(!e.product.stock||!e.product.stock.length||e.currentStock)){var t=parseInt(e.input.currentAmount);return 1>=t?void e.toast("受不了了，宝贝不能再少了"):void(e.input.currentAmount=t-1)}}function f(){var t=parseInt(e.input.currentAmount);1>t&&(e.input.currentAmount=1)}function g(){if(w()&&e.product)if(e.product.stock&&e.product.stock.length){if(!e.currentStock)return;var t=parseInt(e.input.currentAmount),o=parseInt(e.currentStock.stock_number);if(t>=o)return;e.input.currentAmount=t+1}else{var t=parseInt(e.input.currentAmount),o=e.product.good_stock;if(t>=o)return;e.input.currentAmount=t+1}}function m(t,o){if(e.product){var n=e.product;if(o.is_multiselect){var r=[].concat(e.optionalAttrs),i=r.indexOf(o.id);-1==i?r.push(o.id):r.splice(i,1),e.optionalAttrs=r,S()}else{var a=null,r=[].concat(e.currentAttrs),i=r.indexOf(o.id);r.push(o.id);for(var c in t.attrs)if(t.attrs[c].id!=o.id){var i=r.indexOf(t.attrs[c].id);-1!=i&&r.splice(i,1)}if(r=r.filter(function(e,t,o){return o.indexOf(e)===t}),r.sort(function(e,t){return e-t}),r.length)for(var s=r.join("|"),c=0;c<n.stock.length;++c){var u=n.stock[c].goods_attr,l=u.split("|");l.sort(function(e,t){return e-t});var d=l.join("|");if(d==s){a=n.stock[c];break}}e.currentAttrs=r,e.currentStock=a,e.canPurchase=w(),S()}}}function v(){i.go("comment",{product:R})}function $(e){i.go("comment",{product:R})}function y(){return u.getToken()?void i.go("cart-select",{}):void e.goSignin()}function A(){return u.getToken()?void(e.product.is_liked?(e.product.is_liked=!1,c.product.unlike({product:R}).then(function(t){e.product.is_liked=t,e.toast("取消收藏")},function(t){e.product.is_liked=!0})):(e.product.is_liked=!0,c.product.like({product:R}).then(function(t){e.product.is_liked=t,e.toast("收藏成功")},function(t){e.product.is_liked=!1}))):void e.goSignin()}function T(){if(w()){if(!u.getToken())return void e.goSignin();var t=[].concat(e.currentAttrs).concat(e.optionalAttrs),o=Number(e.input.currentAmount);d.add(R,t,o).then(function(t){t&&e.toast("已添加到购物车")})}}function E(){if(w()){if(!u.getToken())return void e.goSignin();var t=e.product,o=[].concat(e.currentAttrs).concat(e.optionalAttrs),n=Number(e.input.currentAmount);l.clear(),l.product=t,l.attrs=o,l.amount=n,i.go("confirm-product",{})}}function S(){var t=[].concat(e.currentAttrs).concat(e.optionalAttrs);e.currentSelectedPrice=parseFloat(e.product.current_price);for(var o=0;o<e.product.properties.length;++o){var n=e.product.properties[o];for(var r in n.attrs){var i=t.indexOf(n.attrs[r].id);-1!=i&&n.attrs[r].attr_price&&(e.currentSelectedPrice+=parseFloat(n.attrs[r].attr_price))}}}function w(){var t=e.product,o=!1;if(!t||!t.good_stock)return!1;for(var n in t.properties)if(!t.properties[n].is_multiselect){o=!0;break}if(o){if(!e.currentAttrs||!e.currentAttrs.length)return!1;if(!e.currentStock)return!1}return!0}function M(e){return s.REVIEW_GRADE.BAD==e?"差评":s.REVIEW_GRADE.MEDIUM==e?"中评":s.REVIEW_GRADE.GOOD==e?"好评":"中评"}function _(t){return t.is_multiselect?-1!=e.optionalAttrs.indexOf(t.id):-1!=e.currentAttrs.indexOf(t.id)}function L(){e.isLoading=!0,c.product.get({product:R}).then(function(t){t.properties.sort(function(e,t){return e.is_multiselect-t.is_multiselect}),e.product=t,e.isLoaded=!0,e.isLoading=!1,e.canPurchase=w();var o=p.getConfig();if(o){var r=o["wxpay.web"];r&&b(r,e.product)}else p.fetch().then(function(){var t=p.getConfig();if(t){var o=t["wxpay.web"];o&&b(o,e.product)}});if(t.photos&&t.photos.length>1){n(function(){e.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1)}else{n(function(){e.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!1,spaceBetween:30,centeredSlides:!0,autoplay:0,autoplayDisableOnInteraction:!1,loop:!1})},1)}for(var i=[],a=null,c=0;c<t.properties.length;++c){var s=t.properties[c];s.is_multiselect||i.push(s.attrs[0].id)}if(i.sort(function(e,t){return e-t}),i.length)for(var u=i.join("|"),c=0;c<t.stock.length;++c){var l=t.stock[c].goods_attr,d=l.split("|");d.sort(function(e,t){return e-t});var h=d.join("|");if(h==u){a=t.stock[c];break}}e.currentAttrs=i,e.currentStock=a,e.canPurchase=w(),S(),P()})}function b(e,t){if(e){var o=t.share_url?t.share_url:t.share_link;wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:e.app_id,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"商品详情",desc:t.name,link:o,imgUrl:t.default_photo.large,success:function(){},cancel:function(){}})}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&$rootScope.toast(JSON.stringify(e))})}}function P(){e.product&&c.review.productList({product:R,grade:s.REVIEW_GRADE.ALL,page:1,per_page:I}).then(function(t){e.comments=t})}function C(){L()}var I=3,R=a.product;e.currentStock=null,e.currentAttrs=[],e.currentSelectedPrice=0,e.input={currentAmount:1},e.optionalAttrs=[],e.canPurchase=!1,e.product=null,e.comments=[],e.cartModel=d,e.touchAmountSub=h,e.touchAmountAdd=g,e.touchAttr=m,e.touchLike=A,e.touchComments=v,e.touchComment=$,e.touchCart=y,e.touchAddCart=T,e.touchPurchase=E,e.refreshAmount=f,e.formatGrade=M,e.isAttrSelected=_,e.isLoading=!1,e.isLoaded=!1,C()}angular.module("app").controller("ProductController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","ConfirmProductService","CartModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("product",{needAuth:!1,url:"/product?product",title:"商品详情",templateUrl:"modules/product/product.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){e.currentTab=e.TAB_ALL,m()}function l(){e.currentTab=e.TAB_BAD,m()}function d(){e.currentTab=e.TAB_MEDIUM,m()}function p(){e.currentTab=e.TAB_GOOD,m()}function h(e){return s.REVIEW_GRADE.BAD==e?"差评":s.REVIEW_GRADE.MEDIUM==e?"中评":s.REVIEW_GRADE.GOOD==e?"好评":"中评"}function f(){e.isLoading||e.isLastPage||(e.comments&&e.comments.length?g(e.comments.length/v+1,v):g(1,v))}function g(t,o){var n=s.REVIEW_GRADE.ALL;e.currentTab==e.TAB_ALL?n=s.REVIEW_GRADE.ALL:e.currentTab==e.TAB_BAD?n=s.REVIEW_GRADE.BAD:e.currentTab==e.TAB_MEDIUM?n=s.REVIEW_GRADE.MEDIUM:e.currentTab==e.TAB_GOOD&&(n=s.REVIEW_GRADE.GOOD),e.isLoading=!0,c.review.productList({product:$,grade:n,page:t,per_page:o}).then(function(t){e.comments=e.comments?e.comments.concat(t):t,e.isEmpty=!e.comments||!e.comments.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=t&&t.length<o?!e.isEmpty:!1})}function m(){e.isLoading||(e.comments=null,e.isEmpty=!1,e.isLoaded=!1,g(1,v))}var v=10,$=a.product;e.TAB_ALL=0,e.TAB_BAD=1,e.TAB_MEDIUM=2,e.TAB_GOOD=3,e.currentPage=0,e.currentTab=e.TAB_ALL,e.comments=null,e.touchTabAll=u,e.touchTabBad=l,e.touchTabMedium=d,e.touchTabGood=p,e.loadMore=f,e.formatGrade=h,e.isEmpty=!1,e.isLoaded=!1,e.isLoading=!1,e.isLastPage=!1,m()}angular.module("app").controller("CommentController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("comment",{needAuth:!1,url:"/comment/?product",title:"商品评价",templateUrl:"modules/comment/comment.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){this.goods=[],this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}}var c={};return c.goods=[],c.invoiceType=null,c.invoiceTitle=null,c.invoiceContent=null,c.express=null,c.cashgift=null,c.consignee=null,c.coupon=null,c.clear=a,c.input={score:0,comment:""},n.$on("consigneeChanged",function(e,t){c.consignee=t}),n.$on("expressChanged",function(e,t){c.express=t}),n.$on("invoiceChanged",function(e,t){c.invoiceTitle=t.title,c.invoiceType=t.type,c.invoiceContent=t.content}),n.$on("cashgiftChanged",function(e,t){c.cashgift=t}),c}angular.module("app").factory("ConfirmCartService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d,p){function h(){n.go("address-select",{address:e.consignee?e.consignee.id:null})}function f(){if(!e.consignee)return void e.toast("请选择地址");for(var t=e.goods,o=[],r=[],i=0;i<t.length;++i)o.push(t[i].product.id),r.push(t[i].amount);l.clear(),l.expressId=e.express?e.express.id:null,l.goodsIds=o,l.goodsNumbers=r,l.region=e.consignee.id,n.go("express-select",{})}function g(){d.clear(),d.type=e.invoiceType?e.invoiceType:null,d.title=e.invoiceTitle,d.content=e.invoiceContent?e.invoiceContent:null,n.go("invoice-select",{})}function m(){var t=e.goods,o=(e.consignee,e.express,e.cashgift),r=0;for(var i in t)r+=t[i].price;n.go("cashgift-select",{cashgift:o?o.id:null,total:r})}function v(){var t=e.goods,o=e.consignee,r=e.express,i=e.coupon,a=e.cashgift,s=e.input.score,d=e.input.comment,h=e.invoiceType,f=e.invoiceTitle,g=e.invoiceContent,m=[];if(!t||!t.length)return void e.toast("商品信息不存在");for(var v=0;v<t.length;++v)m.push(t[v].id);if(!m||!m.length)return void e.toast("商品信息不存在");if(!o)return void e.toast("请填写地址");if(!r)return void e.toast("请选择快递");var $={shop:1,consignee:o?o.id:null,cart_good_id:m?JSON.stringify(m):null,shipping:r?r.id:null,invoice_type:h?h.id:null,invoice_title:f,invoice_content:g?g.id:null,coupon:i?i.id:null,cashgift:a?a.id:null,score:s,comment:d};c.cart.checkout($).then(function(e){e&&(u.clear(),l.clear(),p.clear(),p.order=e,n.go("payment",{order:e.id}))})}function $(){return e.goods&&e.goods.length&&e.consignee?!!e.express:!1}function y(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"}function A(){var t={};c.consignee.list(t).then(function(t){if(t&&(e.consigneeList=t,!e.consignee))for(var o in e.consigneeList)e.consigneeList[o].is_default&&(e.consignee=e.consigneeList[o],r.$emit("consigneeChanged",e.consignee))})}function T(){e.maxUseScore=0;for(var t=0;t<e.goods.length;++t)e.maxUseScore+=e.goods[t].product.score*e.goods[t].amount;
c.score.get({}).then(function(t){e.scoreInfo=t,e.refreshScore()})}function E(){e.timer&&(i.cancel(e.timer),e.timer=null),e.timer=i(function(){var t=e.scoreInfo.score>e.maxUseScore?e.maxUseScore:e.scoreInfo.score;e.input.score>t&&(e.input.score=t),e.input.score<0&&(e.input.score=0),u.input.score=e.input.score,w(),e.timer=null},200)}function S(){u.input.comment=e.input.comment}function w(){var t=e.goods,o=e.consignee,n=e.express,r=e.coupon,i=e.cashgift,a=e.input.score;if(!t||!t.length)return void e.toast("商品信息不存在");if(o){for(var s=[],u=0;u<t.length;++u)s.push({goods_id:t[u].product.id,property:t[u].attrs.split(","),num:t[u].amount});var l={};l.order_product=JSON.stringify(s),o&&(l.consignee=o.id),n&&(l.shipping=n.id),i&&(l.cashgift=i.id),r&&(l.coupon=r.id),a&&(l.score=a),c.order.price(l).then(function(t){e.priceInfo=t,e.all_discount=t.discount_price;for(var o in t.promos)e.all_discount+=parseFloat(t.promos[o].price)})}}function M(){w(),T(),A()}return u.goods&&u.goods.length?(e.touchAddress=h,e.touchExpress=f,e.touchInvoice=g,e.touchCashgift=m,e.touchSubmit=v,e.refreshScore=E,e.refreshComment=S,e.goods=u.goods,e.consignee=u.consignee,e.invoiceType=u.invoiceType,e.invoiceTitle=u.invoiceTitle,e.invoiceContent=u.invoiceContent,e.cashgift=u.cashgift,e.express=u.express,e.coupon=u.coupon,e.all_discount=0,e.input={score:0,comment:""},e.input.score=u.input.score,0==e.input.score&&(e.input.score=""),e.input.comment=u.input.comment,e.scoreInfo=null,e.priceInfo=null,e.canPurchase=$(),e.maxUseScore=0,e.formatPromo=y,void M()):void i(function(){r.goHome()},1)}angular.module("app").controller("ConfirmCartController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","ConfirmCartService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("confirm-cart",{needAuth:!0,url:"/confirm-cart",templateUrl:"modules/confirm-cart/confirm-cart.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){this.product=null,this.properties=null,this.amount=null,this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}}var c={};return c.product=null,c.properties=null,c.amount=null,c.invoiceType=null,c.invoiceTitle=null,c.invoiceContent=null,c.shippingVendor=null,c.cashgift=null,c.consignee=null,c.coupon=null,c.express=null,c.clear=a,c.input={score:0,comment:""},i.$on("consigneeChanged",function(e,t){c.consignee=t}),i.$on("expressChanged",function(e,t){c.express=t}),i.$on("invoiceChanged",function(e,t){c.invoiceTitle=t.title,c.invoiceType=t.type,c.invoiceContent=t.content}),i.$on("cashgiftChanged",function(e,t){c.cashgift=t}),c}angular.module("app").factory("ConfirmProductService",e),e.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){t.go("address-select",{address:e.consignee?e.consignee.id:null})}function l(){if(!e.consignee)return void e.toast("请选择地址");var o=[],n=[];for(var r in e.selectedGoods){var i=e.selectedGoods[r];o.push(i.product.id),n.push(i.amount)}a.clear(),a.expressId=e.express?e.express.id:null,a.goodsIds=o,a.goodsNumbers=n,a.region=e.consignee.id,t.go("express-select",{})}function d(){c.clear(),c.type=e.invoiceType?e.invoiceType:null,c.title=e.invoiceTitle,c.content=e.invoiceContent?e.invoiceContent:null,t.go("invoice-select",{})}function p(){t.go("cashgift-select",{cashgift:e.cashgift?e.cashgift.id:null,total:e.priceInfo?e.priceInfo.product_price:0})}function h(){return e.selectedGoods&&e.selectedGoods.length&&e.consignee?!!e.express:!1}function f(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"}function g(){var t={};r.consignee.list(t).then(function(t){if(t&&(e.consigneeList=t,!e.consignee)){for(var n in e.consigneeList)e.consigneeList[n].is_default&&(e.consignee=e.consigneeList[n],o.$emit("consigneeChanged",e.consignee));y()}})}function m(){e.maxUseScore=0;for(var t=0;t<e.selectedGoods.length;++t)e.maxUseScore+=e.selectedGoods[t].product.score*e.selectedGoods[t].amount;r.score.get({}).then(function(t){e.scoreInfo=t})}function v(){var t=e.scoreInfo.score>e.maxUseScore?e.maxUseScore:e.scoreInfo.score;e.input.score>t&&(e.input.score=t),e.input.score<0&&(e.input.score=0),i.input.score=e.input.score,y()}function $(){i.input.comment=e.input.comment}function y(){if(e.consignee){var t=[];for(var o in e.selectedGoods){var n=e.selectedGoods[o],i={goods_id:n.product.id,property:n.attrs,num:n.amount,total_amount:n.amount};t.push(i)}var a={};a.order_product=JSON.stringify(t),e.consignee&&(a.consignee=e.consignee.id),e.express&&(a.shipping=e.express.id),e.cashgift&&(a.cashgift=e.cashgift.id),e.coupon&&(a.coupon=e.coupon.id),e.input.score&&(a.score=e.input.score),r.order.price(a).then(function(t){if(t){e.priceInfo=t,e.all_discount=t.discount_price;for(var o in t.promos)e.all_discount+=parseFloat(t.promos[o].price)}})}}function A(){var o=e.consignee,n=e.express;if(!o)return void e.toast("请填写地址");if(!n)return void e.toast("请选择快递");var c={};for(var u in e.selectedGoods){var l=e.selectedGoods[u];c.product=l.product.id,c.property=JSON.stringify(l.attrs),c.amount=l.amount}e.consignee&&(c.consignee=e.consignee.id),e.express&&(c.shipping=e.express.id),e.cashgift&&(c.cashgift=e.cashgift.id),e.input.score&&(c.score=e.input.score),e.invoiceContent&&(c.invoice_content=e.invoiceContent.id),e.invoice&&(c.invoice_type=e.invoiceType.id),e.invoiceTitle&&(c.invoice_title=e.invoiceTitle),e.input.comment&&(c.comment=e.input.comment),r.product.purchase(c).then(function(e){e&&(i.clear(),a.clear(),s.clear(),s.order=e,t.go("payment",{order:e.id}))})}if(e.touchAddress=u,e.touchExpress=l,e.touchInvoice=d,e.touchCashgift=p,e.touchSubmit=A,e.refreshScore=v,e.refreshComment=$,e.consigneeList=[],e.consignee=i.consignee,e.invoiceType=i.invoiceType,e.invoiceTitle=i.invoiceTitle,e.invoiceContent=i.invoiceContent,e.cashgift=i.cashgift,e.express=i.express,e.coupon=i.coupon,e.all_discount=0,e.input={score:0,comment:""},e.input.score=i.input.score,e.input.comment=i.input.comment,0==e.input.score&&(e.input.score=""),e.rule="",e.scoreInfo=null,e.priceInfo={},e.canPurchase=h,e.formatPromo=f,e.maxUseScore=0,e.selectedGoods=[],i.product){var T={};T.product=i.product;var E=i.attrs;T.property="",T.attrs=[];for(var S=parseFloat(T.product.current_price),w=E.length,M=0;w>M;M++)for(var _=T.product.properties.length,L=0;_>L;L++)for(var b=T.product.properties[L],w=b.attrs.length,P=0;w>P;P++){var C=b.attrs[P];parseInt(C.id)==E[M]&&(T.property.length>0?T.property+=","+C.attr_name:T.property=C.attr_name,T.attrs.push(C.id),S+=parseFloat(C.attr_price))}T.amount=i.amount,T.price=S,e.selectedGoods.push(T),g(),m(),y()}}angular.module("app").controller("ConfirmController",e),e.$inject=["$scope","$state","$rootScope","$stateParams","API","ConfirmProductService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("confirm-product",{needAuth:!0,url:"/confirm-product",title:"确认订单",templateUrl:"modules/confirm-product/confirm-product.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){this.order=null}function u(){if(i.getToken()){var e=this;return a.payment.typeList({}).then(function(t){return t&&(e.types=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1),!!t})}}var l={};return l.isEmpty=!1,l.isLoaded=!1,l.isLoading=!1,l.types=null,l.order=null,l.reload=u,l.clear=s,l}angular.module("app").factory("PaymentModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(t){return e.selectedType?t.code==e.selectedType.code:!1}function d(t){e.selectedType=t}function p(){if(!e.selectedType)return void e.toast("请选择支持方式");switch(e.selectedType.code){case"alipay.app":case"alipay.wap":n.go("alipay-wap",{order:u.order.id});break;case"wxpay.app":case"wxpay.web":r.isWeixin()?n.go("wechat-pay",{order:u.order.id}):e.toast("暂不支持此方式");break;case"unionpay.app":e.toast("暂不支持此方式");break;case"teegon.wap":n.go("teegon",{order:u.order.id});break;default:e.toast("暂不支持此方式")}}function h(){n.go("order-detail",{order:e.paymentModel.order.id})}function f(){e.paymentModel.reload().then(function(e){})}return u.order?(e.selectedType=null,e.paymentModel=u,e.isSelected=l,e.touchSelect=d,e.touchSubmit=p,e.touchDetail=h,void f()):void i(function(){r.goHome()},1)}angular.module("app").controller("PaymentController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel"]}(),function(){"use strict";function e(e,t){e.state("payment",{needAuth:!1,url:"/payment",title:"收银台",templateUrl:"modules/payment/payment.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("payment-success",{needAuth:!0,url:"/payment-success?order",title:"付款成功",templateUrl:"modules/payment-success/payment-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.reason=r.reason,e.touchDetail=function(){n.go("order-detail",{order:i})}}angular.module("app").controller("PaymentFailedController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("payment-failed",{needAuth:!0,url:"/payment-failed?order&reason",title:"支付失败",templateUrl:"modules/payment-failed/payment-failed.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){this.title=null,this.type=null,this.content=null}var c={};return c.title=null,c.type=null,c.content=null,c.clear=a,c}angular.module("app").factory("InvoiceSelectService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(t){e.selectedType=t,e.noInvoice=!1}function u(t){e.selectedContent=t,e.noInvoice=!1}function l(){if(e.noInvoice)o.$emit("invoiceChanged",{title:null,type:null,content:null}),e.goBack();else{if(!e.types)return void e.toast("请选择发票类型");if(!e.contents)return void e.toast("请选择发票明细");if(!e.input.title||!e.input.title.length)return void e.toast("请填写发票抬头");o.$emit("invoiceChanged",{title:e.input.title,type:e.selectedType,content:e.selectedContent}),e.goBack()}}function d(){e.noInvoice=!e.noInvoice,e.noInvoice&&(e.input.title=null,e.selectedType=null,e.selectedContent=null)}function p(){i.invoice.typeList({}).then(function(t){for(var o=new Array,n=0;n<t.length;n++){var r=t[n];r.name.length&&o.push(r)}e.types=o;var i=e.selectedType;if(i)for(var n=0;n<t.length;++n)if(t[n].id==i.id){e.selectedType=t[n];break}e.noInvoice=f()})}function h(){i.invoice.contentList({}).then(function(t){e.contents=t;var o=e.selectedContent;if(o)for(var n=0;n<t.length;++n)if(t[n].id==o.id){e.selectedContents=t[n];break}e.noInvoice=f()})}function f(){return e.input.title&&e.input.title.length?!1:e.selectedType?!1:!e.selectedContent}function g(){p(),h()}e.input={title:c.title},e.selectedType=c.type,e.selectedContent=c.content,e.types=null,e.contents=null,e.touchType=s,e.touchContent=u,e.touchConfirm=l,e.touchToggle=d,e.noInvoice=f(),g()}angular.module("app").controller("InvoiceSelectController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$state","API","ENUM","InvoiceSelectService"]}(),function(){"use strict";function e(e,t){e.state("invoice-select",{needAuth:!0,url:"/invoice-select",title:"发票信息",templateUrl:"modules/invoice-select/invoice-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i){function a(){this.expressId=null,this.goodsIds=null,this.goodsNumbers=null,this.region=null}var c={};return c.expressId=null,c.goodsIds=null,c.goodsNumbers=null,c.region=null,c.clear=a,c}angular.module("app").factory("ExpressSelectService",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(t){n.$emit("expressChanged",t),e.goBack()}function l(){for(var t=e.goodsIds,o=e.goodsNumbers,n=[],r=0;r<t.length&&r<o.length;++r)n.push({goods_id:t[r],num:o[r]});var i=[];for(var c in e.selectedGoods){var s=e.selectedGoods[c],u={goods_id:s.product.id,num:s.amount};i.push(u)}a.shipping.vendorList({shop:1,products:JSON.stringify(n),address:e.region}).then(function(t){e.vendors=t})}e.selectedId=s.expressId||null,e.goodsIds=s.goodsIds||[],e.goodsNumbers=s.goodsNumbers||[],e.region=s.region||null,e.vendors=[],e.touchVendor=u,l()}angular.module("app").controller("ExpressSelectController",e),e.$inject=["$scope","$http","$window","$rootScope","$state","$stateParams","API","ENUM","ExpressSelectService"]}(),function(){"use strict";function e(e,t){e.state("express-select",{needAuth:!0,url:"/express-select",title:"配送方式",templateUrl:"modules/express-select/express-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){this.cashgifts=null,this.totalPrice=0}function u(){c.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.fetch(1,p)))}function l(){c.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/p+1,p):this.fetch(1,p)))}function d(e,t){if(c.getToken()){this.isLoading=!0;var o=this;i.cashgift.available({total_price:this.totalPrice,page:e,per_page:t}).then(function(e){o.cashgifts=o.cashgifts?o.cashgifts.concat(e):e,o.isEmpty=!o.cashgifts||!o.cashgifts.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=e&&e.length<t?!o.isEmpty:!1})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.cashgifts=null,h.totalPrice=0,h.clear=s,h.fetch=d,h.reload=u,h.loadMore=l,h}angular.module("app").factory("CashgiftSelectModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.selectedId=null}function d(t){e.selectedId=t.id}function p(){var t=null,o=e.cashgiftSelectModel.cashgifts;for(var n in o)if(o[n].id==e.selectedId){t=o[n];break}r.$emit("cashgiftChanged",t),e.goBack()}e.selectedId=i.cashgift||null,e.totalPrice=i.total||0,e.cashgiftSelectModel=u,e.cashgiftSelectModel.clear(),e.cashgiftSelectModel.totalPrice=e.totalPrice,e.touchClear=l,e.touchCashgift=d,e.touchConfirm=p,e.cashgiftSelectModel.reload()}angular.module("app").controller("CashgiftSelectController",e),e.$inject=["$scope","$http","$location","$timeout","$rootScope","$stateParams","$state","API","ENUM","CashgiftSelectModel"]}(),function(){"use strict";function e(e,t){e.state("cashgift-select",{needAuth:!0,url:"/cashgift-select?cashgift&total",title:"选择红包",templateUrl:"modules/cashgift-select/cashgift-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){function c(){this.consignees=null}function s(){this.isLoading=!1,this.isLoaded=!1;var e=this;return i.consignee.list({}).then(function(t){e.consignees=t,e.isLoading=!1,e.isLoaded=!0})}var u={};return u.isLoading=!1,u.isLoaded=!1,u.consignees=null,u.clear=c,u.reload=s,u}angular.module("app").factory("AddressSelectModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){e.addressEditModel.clear(),e.addressEditModel.consignee=null,r.go("address-edit",{})}function l(t){e.addressEditModel.clear(),e.addressEditModel.consignee=t,r.go("address-edit",{})}function d(t){n.$emit("consigneeChanged",t),e.goBack()}function p(e){return!!e.is_default}function h(t){i.consignee.setDefault({consignee:t.id}).then(function(o){if(o)for(var n=0;n<e.myAddressModel.consignees.length;n++){var r=e.myAddressModel.consignees[n];r.id==t.id?r.is_default=!0:r.is_default=!1}else e.toast("设置失败")})}e.selectedId=o.address,e.addressSelectModel=s,e.touchCreate=u,e.touchModify=l,e.touchConsignee=d,e.touchDefaultAddress=h,e.isDefaultAddress=p,e.addressEditModel=c,e.addressSelectModel.clear(),e.addressSelectModel.reload()}angular.module("app").controller("AddressSelectController",e),e.$inject=["$scope","$http","$stateParams","$rootScope","$state","API","ENUM","AddressEditModel","AddressSelectModel"]}(),function(){"use strict";function e(e,t){e.state("address-select",{needAuth:!0,url:"/address-select?address",title:"选择地址",templateUrl:"modules/address-select/address-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){this.consignee=null}function u(e,t,o,n){if(c.getToken()){if(this.consignee&&this.consignee.id){var r=this;return i.consignee.update({consignee:this.consignee.id,name:e,mobile:t,tel:t,zip_code:"",region:o,address:n}).then(function(e){return r.consignee=e,!!e})}var r=this;return i.consignee.add({name:e,mobile:t,tel:t,zip_code:"",region:o,address:n}).then(function(e){return r.consignee=e,!!e})}}function l(){if(c.getToken()&&!this.isLoading){this.isLoading=!0;var e=this;return i.region.list({}).then(function(t){return t&&t.length?(e.isLoading=!1,e.isLoaded=!0,e.regions=t):$scope.toast("没有可选地址"),!!t})}}function d(){if(c.getToken()){if(this.isLoaded){var e=t.defer();return o(function(){e.resolve(!0)},1),e.promise}return this.reload()}}var p={};return p.isLoaded=!1,p.isLoading=!1,p.consignee=null,p.regions=null,p.save=u,p.clear=s,p.reload=l,p.reload=l,p.reloadIfNeeded=d,p}angular.module("app").factory("AddressEditModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){e.goBack()}function l(){var t=e.name,o=e.mobile,n=e.address,r=e.regions;if(!t||t.length<2)return void e.toast("请输入姓名");if(!o||o.length<5)return void e.toast("请输入电话");if(!r||!r.length)return void e.toast("请选择地区");var i=r[r.length-1];return i?!n||n.length<1?void e.toast("请输入地址"):void(e.allowSave&&(e.allowSave=!1,e.addressEditModel.save(t,o,i.id,n).then(function(t){e.allowSave=!0,t?(e.toast("保存成功"),e.goBack()):e.toast("请稍后再试")}))):void e.toast("请选择地区")}function d(){e.isDefault=!e.isDefault}function p(){var t={};t.consignee=e.addressEditModel.consignee.id,o.consignee["delete"](t).then(function(t){t?(e.toast("删除成功"),e.goBack()):e.toast("删除失败")})}function h(){e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null,e.showPicker=!0,e.addressEditModel.reloadIfNeeded().then(function(t){t?e.pickerData=e.addressEditModel.regions:(e.toast("请稍后再试"),e.touchPickerCancel())})}function f(t){e.pickerRegions.push(t),e.pickerRegionName=m(e.pickerRegions),t.regions&&t.regions.length?e.pickerData=t.regions:(e.regions=e.pickerRegions,e.showPicker=!1)}function g(){e.showPicker=!1,e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null}function m(e){for(var t="",o=0;o<e.length;++o)t+=e[o].name,t+=" ";return t}e.touchSave=l,e.touchSetDefault=d,e.touchPickerShow=h,e.touchPickerRegion=f,e.touchPickerCancel=g,e.formatRegions=m,e.touchDelete=p,e.touchCancel=u,e.showPicker=!1,e.allowSave=!0,e.pickerData=[],e.pickerRegions=[],e.pickerRegionName=null,e.addressEditModel=s;var v=e.addressEditModel.consignee;v&&v.id&&(e.name=v.name,e.mobile=v.mobile,e.regions=v.regions,e.address=v.address,e.isDefault=v.is_default)}angular.module("app").controller("AddressEditController",e),e.$inject=["$scope","$http","API","$location","$q","$window","$state","$stateParams","AddressEditModel"]}(),function(){"use strict";function e(e,t){e.state("address-edit",{needAuth:!0,url:"/address-edit",title:"收货地址",templateUrl:"modules/address-edit/address-edit.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.getToken()&&(this.isLoading||(this.orders=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.orders&&this.orders.length?this.fetch(this.orders.length/d+1,d):this.fetch(1,d)))}function l(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.order.list(o).then(function(e){n.orders=n.orders?n.orders.concat(e):e,n.isEmpty=!n.orders||!n.orders.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=e&&e.length<t?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.orders=null,p.fetch=l,p.reload=s,p.loadMore=u,p}angular.module("app").factory("MyOrderModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l,d){function p(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null,e.myOrderModel.reload())}function h(){e.currentTab!=e.TAB_CREATED&&(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=s.ORDER_STATUS.CREATED,e.myOrderModel.reload())}function f(){e.currentTab!=e.TAB_PAID&&(e.currentTab=e.TAB_PAID,e.myOrderModel.status=s.ORDER_STATUS.PAID,e.myOrderModel.reload())}function g(){e.currentTab!=e.TAB_DELIVERING&&(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=s.ORDER_STATUS.DELIVERING,e.myOrderModel.reload())}function m(){e.currentTab!=e.TAB_DELIVERIED&&(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=s.ORDER_STATUS.DELIVERIED,e.myOrderModel.reload())}function v(e){i.go("order-detail",{order:e.id})}function $(e){c.order.confirm({order:e.id}).then(function(e){i.go("confirm-delivery",{order:e.id})})}function y(t){e.orderExpressModel.clear(),e.orderExpressModel.order=t,i.go("order-express",{order:t.id})}function A(e){i.go("order-review",{order:e.id})}function T(t){t&&(e.paymentModel.clear(),e.paymentModel.order=t,i.go("payment",{}))}function E(t){e.cancellingOrder=t,e.showDialog=!0}function S(){e.cancellingOrder=null,e.showDialog=!1}function w(){c.order.cancel({order:e.cancellingOrder.id,reason:1}).then(function(t){e.myOrderModel.reload(),e.cancellingOrder=null,e.showDialog=!1})}e.TAB_ALL=0,e.TAB_CREATED=1,e.TAB_PAID=2,e.TAB_DELIVERING=3,e.TAB_DELIVERIED=4,e.currentTab=e.TAB_ALL,e.cancellingOrder=null,e.showDialog=!1,e.myOrderModel=l,e.paymentModel=u,e.orderExpressModel=d,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null):"created"==a.tab?(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=s.ORDER_STATUS.CREATED):"paid"==a.tab?(e.currentTab=e.TAB_PAID,e.myOrderModel.status=s.ORDER_STATUS.PAID):"delivering"==a.tab?(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=s.ORDER_STATUS.DELIVERING):"delivered"==a.tab?(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=s.ORDER_STATUS.DELIVERIED):(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null),e.touchTabAll=p,e.touchTabCreated=h,e.touchTabPaid=f,e.touchTabDelivering=g,e.touchTabDeliveried=m,e.touchDialogCancel=S,e.touchDialogConfirm=w,e.touchOrder=v,e.touchPay=T,e.touchCancel=E,e.touchConfirm=$,e.touchExpress=y,e.touchComment=A,e.myOrderModel.reload()}angular.module("app").controller("MyOrderController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyOrderModel","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("my-order",{needAuth:!0,url:"/my-order?tab",title:"我的订单",templateUrl:"modules/my-order/my-order.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){function d(){e.order&&(e.paymentModel.clear(),e.paymentModel.order=e.order,i.go("payment",{}))}function p(){e.order&&(e.showDialog=!0)}function h(){e.showDialog=!1}function f(){c.order.cancel({order:A,reason:1}).then(function(t){e.toast("取消成功"),e.showDialog=!1,y()})}function g(){c.order.confirm({order:A}).then(function(t){e.toast("确认成功"),y()})}function m(){e.orderExpressModel.clear(),e.orderExpressModel.order=e.order,i.go("order-express",{order:e.order.id})}function v(){i.go("order-review",{order:e.order.id})}function $(e){i.go("product",{product:e.id})}function y(){e.isLoading=!0,e.isLoaded=!1,c.order.get({order:A}).then(function(t){e.order=t;var o=t.promos;e.promos=[];for(var n in o)"score"==o[n].promo?o[n].name="积分":"cashgift"==o[n].promo?o[n].name="红包":"preferential"==o[n].promo?o[n].name="优惠金额":"goods_reduction"==o[n].promo?o[n].name="商品减免":"order_reduction"==o[n].promo?o[n].name="订单减免":"coupon_reduction"==o[n].promo&&(o[n].name="优惠券减免");e.promos=o,e.isLoading=!1,e.isLoaded=!0})}var A=a.order;e.order={id:A},e.isLoading=!1,e.isLoaded=!1,e.touchPay=d,e.touchCancel=p,e.touchConfirm=g,e.touchExpress=m,e.touchComment=v,e.touchProduct=$,e.showDialog=!1,e.touchDialogCancel=h,e.touchDialogConfirm=f,e.paymentModel=u,e.orderExpressModel=l,y()}angular.module("app").controller("OrderDetailController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("order-detail",{needAuth:!0,url:"/order-detail/?order",title:"订单详情",templateUrl:"modules/order-detail/order-detail.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s){function u(){e.isLoading=!0,e.isLoaded=!1,c.order.get({order:g}).then(function(t){e.order=t,e.isLoading=!1,e.isLoaded=!0})}function l(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.GOOD,e.review.content||(e.review.content="")}function d(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.MEDIUM,e.review.content||(e.review.content="")}function p(e){e.review||(e.review={}),e.review.goods=e.id,e.review.grade=s.ORDER_GRADE.BAD,e.review.content||(e.review.content="")}function h(){e.isAnonymous=!e.isAnonymous}function f(){for(var t=[],o=0;o<e.order.goods.length;o++){var n=e.order.goods[o];if(n.review){if(!n.review.grade)return void e.toast("请选择评价");t.push(n.review)}}if(t.length<e.order.goods.length)return void e.toast("请评价全部商品");var r={};r.order=g,r.review=JSON.stringify(t),e.isAnonymous?r.is_anonymous=1:r.is_anonymous=0,c.order.review(r).then(function(t){t&&i.go("review-success",{order:e.order.id})})}var g=a.order;e.order={id:g},e.isLoading=!1,e.isLoaded=!1,e.isAnonymous=0,e.touchGood=l,e.touchMedium=d,e.touchBad=p,e.touchSetAnonymous=h,e.touchSubmit=f,u()}angular.module("app").controller("OrderReviewController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("order-review",{needAuth:!0,url:"/order-review?order",title:"订单评价",templateUrl:"modules/order-review/order-review.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){this.order=null,this.info=null}function u(){var e=this;return a.shipping.statusGet({order_id:this.order.id,tracking_no:null}).then(function(t){return e.info=t,!!t})}var l={};return l.order=null,l.info=null,l.clear=s,l.reload=u,l}angular.module("app").factory("OrderExpressModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.orderExpressModel=u,e.orderExpressModel.reload()}angular.module("app").controller("OrderExpressController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","OrderExpressModel"]}(),function(){"use strict";function e(e,t){e.state("order-express",{needAuth:!0,url:"/order-express/?order",title:"物流信息",templateUrl:"modules/order-express/order-express.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a="snsapi_userinfo",c=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+a+"&referer="+i;o.location.href=c}angular.module("app").controller("WeChatAuthController",e),e.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function e(e,t){e.state("wechat-auth",{needAuth:!1,url:"/wechat-auth",title:"微信登录",controller:"WeChatAuthController",templateUrl:"modules/wechat-auth/wechat-auth.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){var d=a.order;if(!d)return void r.go("payment-failed",{order:d,reason:"参数错误"});o.$on("onPaySuccess",function(e,t){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(e,t){r.go("payment-failed",{order:d,reason:"微信支付失败"})});var p=l.getConfig(),h=p["wxpay.web"];return h?(wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:h.app_id,timestamp:h.timestamp,nonceStr:h.nonceStr,signature:h.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){c.pay(d).then(function(e){})}),void wx.error(function(e){GLOBAL_CONFIG.DEBUG&&o.toast(JSON.stringify(e))})):void r.go("payment-failed",{order:d,reason:"配置错误"})}angular.module("app").controller("WeChatPayController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","WeixinService","API","ENUM","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("wechat-pay",{needAuth:!0,url:"/wechat-pay?order",title:"微信支付",controller:"WeChatPayController",templateUrl:"modules/wechat-pay/wechat-pay.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a="snsapi_base",c=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+a+"&referer="+i;o.location.href=c}angular.module("app").controller("WeChatAuthBaseController",e),e.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function e(e,t){e.state("wechat-authbase",{needAuth:!1,url:"/wechat-authbase",title:"微信登录",controller:"WeChatAuthBaseController",templateUrl:"modules/wechat-authbase/wechat-authbase.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){e.paymentModel=c;var d=a.order;if(!d)return void r.go("payment-failed",{order:d,reason:"参数错误"});o.$on("onPaySuccess",function(e,t){r.go("payment-success",{order:d})}),o.$on("onPayFailed",function(e,t){r.go("payment-failed",{order:d,reason:"支付宝支付失败"})});var p=encodeURIComponent(n.location.protocol+"//"+n.location.host+n.location.pathname),h={order:d,code:"alipay.wap",referer:p};s.payment.pay(h).then(function(t){return t.data.alipay&&t.data.alipay.html&&(e.alipay_html=u.trustAsHtml(t.data.alipay.html)),!0})}angular.module("app").controller("AliPayWapController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","PaymentModel","API","$sce","ConfigModel"]}(),function(){"use strict";function e(e,t){
e.state("alipay-wap",{needAuth:!0,url:"/alipay-wap?order",title:"微信支付",controller:"AliPayWapController",templateUrl:"modules/alipay-wap/alipay-wap.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){if(i.getToken()&&!this.isLoading){this.consignees=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1;var e=this;a.consignee.list({}).then(function(t){e.consignees=t,e.isEmpty=!e.consignees||!e.consignees.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!0})}}var u={};return u.isEmpty=!1,u.isLoaded=!1,u.isLoading=!1,u.isLastPage=!1,u.consignees=null,u.reload=s,u}angular.module("app").factory("MyAddressModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.addressEditModel.clear(),e.addressEditModel.consignee=null,i.go("address-edit",{})}function d(t){e.addressEditModel.clear(),e.addressEditModel.consignee=t,i.go("address-edit",{})}function p(e){return!!e.is_default}function h(t){a.consignee.setDefault({consignee:t.id}).then(function(o){if(o)for(var n=0;n<e.myAddressModel.consignees.length;n++){var r=e.myAddressModel.consignees[n];r.id==t.id?r.is_default=!0:r.is_default=!1}else e.toast("设置失败")})}e.touchCreate=l,e.touchModify=d,e.myAddressModel=u,e.addressEditModel=s,e.touchDefaultAddress=h,e.isDefaultAddress=p,e.myAddressModel.reload()}angular.module("app").controller("MyAddressController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$location","$state","API","ENUM","AddressEditModel","MyAddressModel"]}(),function(){"use strict";function e(e,t){e.state("my-address",{needAuth:!0,url:"/my-address",title:"地址管理",templateUrl:"modules/my-address/my-address.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(e){if(i.getToken()){var t=this;a.product.unlike({product:e}).then(function(e){t.reload()})}}function u(){i.getToken()&&(this.isLoading||(this.products=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p)))}function l(){this.isLoading||this.isLastPage||(this.products&&this.products.length?this.fetch(this.products.length/p+1,p):this.fetch(1,p))}function d(e,t){this.isLoading=!0;var o=this;a.product.likedList({page:e,per_page:t}).then(function(e){o.products=o.products?o.products.concat(e):e,o.isEmpty=!o.products||!o.products.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=e&&e.length<t?!o.isEmpty:!1})}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.products=null,h.fetch=d,h.reload=u,h.loadMore=l,h["delete"]=s,h}angular.module("app").factory("MyFavoriteModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r){function i(e){t.go("product",{product:e.id})}function a(t){e.myFavoriteModel["delete"](t.id)}e.myFavoriteModel=r,e.touchProduct=i,e.touchDelete=a,e.myFavoriteModel.reload()}angular.module("app").controller("MyFavoriteController",e),e.$inject=["$scope","$state","API","ENUM","MyFavoriteModel"]}(),function(){"use strict";function e(e,t){e.state("my-favorite",{needAuth:!0,url:"/my-favorite",title:"我的收藏",templateUrl:"modules/my-favorite/my-favorite.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.getToken()&&(this.isLoading||(this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/d+1,d):this.fetch(1,d)))}function l(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};o.status=this.status;var n=this;a.cashgift.list(o).then(function(e){n.cashgifts=n.cashgifts?n.cashgifts.concat(e):e,n.isEmpty=!n.cashgifts||!n.cashgifts.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=e&&e.length<t?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.cashgifts=null,p.fetch=l,p.reload=s,p.loadMore=u,p}angular.module("app").factory("MyCashgiftModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){function c(){e.currentTab!=e.TAB_AVAILABLE&&(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE,e.myCashgiftModel.reload())}function s(){e.currentTab!=e.TAB_EXPIRED&&(e.currentTab=e.TAB_EXPIRED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED,e.myCashgiftModel.reload())}function u(){e.currentTab!=e.TAB_USED&&(e.currentTab=e.TAB_USED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.USED,e.myCashgiftModel.reload())}e.TAB_AVAILABLE=0,e.TAB_EXPIRED=1,e.TAB_USED=2,e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel=i,"available"==n.tab?(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE):"expired"==n.tab?(e.currentTab=e.TAB_EXPIRED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.EXPIRED):"used"==n.tab?(e.currentTab=e.TAB_USED,e.myCashgiftModel.status=a.CASHGIFT_STATUS.USED):(e.currentTab=e.TAB_AVAILABLE,e.myCashgiftModel.status=a.CASHGIFT_STATUS.AVAILABLE),e.touchTabAvailable=c,e.touchTabExpired=s,e.touchTabUsed=u,e.myCashgiftModel.reload()}angular.module("app").controller("MyCashgiftController",e),e.$inject=["$scope","$http","$location","$stateParams","$state","MyCashgiftModel","ENUM"]}(),function(){"use strict";function e(e,t){e.state("my-cashgift",{needAuth:!0,url:"/my-cashgift",title:"我的红包",templateUrl:"modules/my-cashgift/my-cashgift.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){if(i.getToken()){var e=this;a.score.get({}).then(function(t){e.score=t.score,e.rule=t.rule})}}function u(){i.getToken()&&(this.isLoading||(this.history=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p)))}function l(){i.getToken()&&(this.isLoading||this.isLastPage||(this.history&&this.history.length?this.fetch(this.history.length/p+1,p):this.fetch(1,p)))}function d(e,t){this.isLoading=!0;var o=this,n={page:e,per_page:t};this.status&&(n.status=this.status),a.score.historyList(n).then(function(e){o.history=o.history?o.history.concat(e):e,o.isEmpty=!o.history||!o.history.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=e&&e.length<t?!o.isEmpty:!1})}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.score=null,h.rule=null,h.history=null,h.count=s,h.fetch=d,h.reload=u,h.loadMore=l,h}angular.module("app").factory("MyScoreModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){function d(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null,e.myScoreModel.reload())}function p(){e.currentTab!=e.TAB_INCOME&&(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=s.SCORE_STATUS.INCOME,e.myScoreModel.reload())}function h(){e.currentTab!=e.TAB_EXPENDITURE&&(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=s.SCORE_STATUS.EXPENDITURE,e.myScoreModel.reload())}e.TAB_ALL=0,e.TAB_INCOME=1,e.TAB_EXPENDITURE=2,e.currentTab=e.TAB_ALL,e.myScoreModel=l,e.paymentModel=u,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null):"income"==a.tab?(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=s.SCORE_STATUS.INCOME):"expenditure"==a.tab?(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=s.SCORE_STATUS.EXPENDITURE):(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null),e.touchTabAll=d,e.touchTabIncome=p,e.touchTabExpenditure=h,e.myScoreModel.count(),e.myScoreModel.reload()}angular.module("app").controller("MyScoreController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyScoreModel"]}(),function(){"use strict";function e(e,t){e.state("my-score",{needAuth:!0,url:"/my-score?tab",title:"我的积分",templateUrl:"modules/my-score/my-score.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){function i(){if(!e.loading){var t={};l=1,t=s?{page:l,per_page:u,id:s}:{page:l,per_page:u,id:0},n.article.list(t).then(function(t){t&&(e.articles=t.articles,e.loading=!1,e.loaded=!0,e.more=parseInt(t.paged.more))})}}function a(){if(!e.loading){var t={};t=s?{page:l,per_page:u,id:s}:{page:l,per_page:u,id:0},n.article.list(t).then(function(t){t&&(e.articles=e.articles.concat(t.articles),e.loading=!1,e.loaded=!0,e.more=parseInt(t.paged.more))})}}function c(e){e.url?r.location.href=e.url:t.go("article",{id:e.id,title:e.title})}e.touchArticle=c,e.articles=[];var s=o.id;o.title?e.title=o.title:e.title="使用帮助",e.loading=!1,e.loaded=!1,e.more=!0;var u=10,l=1;e.reload=i,e.loadMore=a,i()}angular.module("app").controller("ArticleController",e),e.$inject=["$scope","$state","$stateParams","API","$window"]}(),function(){"use strict";function e(e,t){e.state("article",{needAuth:!1,url:"/article?id&title",title:"使用帮助",templateUrl:"modules/article/article.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){r.order;e.reason=r.reason,e.touchToHome=function(){n.go("home",{})}}angular.module("app").controller("ReviewSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("review-success",{needAuth:!0,url:"/review-success?order",title:"评价成功",templateUrl:"modules/review-success/review-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=r.order;e.isDelivery=!0,e.reason=r.reason,e.touchDetail=function(){n.go("order-detail",{order:i})},e.touchComment=function(){n.go("order-review",{order:i})}}angular.module("app").controller("ConfirmDeliveryController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("confirm-delivery",{needAuth:!0,url:"/confirm-delivery?order",title:"交易成功",templateUrl:"modules/confirm-delivery/confirm-delivery.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a){function c(){var t=e.oldPassword,o=e.newPassword,n=e.newPassword2;return o!=n?void e.toast("两次密码输入不一致"):void i.user.passwordUpdate({old_password:t,password:o}).then(function(t){0==t.data.error_code?(e.toast("密码修改成功"),e.goBack()):e.toast(t.data.error_desc)})}e.oldPassword="",e.newPassword="",e.touchChangePassword=c}angular.module("app").controller("ChangePasswordController",e),e.$inject=["$scope","$http","$window","$location","$state","API","ENUM"]}(),function(){"use strict";function e(e,t){e.state("change-password",{needAuth:!0,url:"/change-password",title:"修改密码",templateUrl:"modules/change-password/change-password.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){function d(t){return e.selectedType?t.channel==e.selectedType.channel:!1}function p(t){e.selectedType=t}function h(){if(!e.selectedType)return void e.toast("请选择支持方式");switch(e.selectedType.channel){case"chinapay":var t=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:e.paymentModel.order.id,code:"teegon.wap",channel:"chinapay",referer:t};c.payment.pay(o).then(function(e){return e.data.teegon&&e.data.teegon.url&&(l.location.href=e.data.teegon.url),!0});break;case"wxpay":var t=encodeURIComponent(l.location.protocol+"//"+l.location.host+l.location.pathname),o={order:e.paymentModel.order.id,code:"teegon.wap",channel:"wxpay_jsapi",referer:t};c.payment.pay(o).then(function(e){return e.data.teegon&&e.data.teegon.url&&(l.location.href=e.data.teegon.url),!0})}}function f(){var t={name:"微信支付",desc:"天工收银微信支付",channel:"wxpay"},o={name:"天工收银银联支付",desc:"天工收银银联支付",channel:"chinapay"};e.teegonTypes.push(o),e.teegonTypes.push(t),e.paymentModel.reload().then(function(e){})}return u.order?(e.selectedType=null,e.paymentModel=u,e.isSelected=d,e.touchSelect=p,e.touchSubmit=h,e.teegonTypes=[],void f()):void i(function(){r.goHome()},1)}angular.module("app").controller("TeegonController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","$window"]}(),function(){"use strict";function e(e,t){e.state("teegon",{needAuth:!1,url:"/teegon",title:"收银台",templateUrl:"modules/teegon/teegon.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r){var i=encodeURIComponent(o.location.protocol+"//"+o.location.host+o.location.pathname),a=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=3&referer="+i;o.location.href=a}angular.module("app").controller("QQAuthController",e),e.$inject=["$scope","$http","$window","$location","$timeout"]}(),function(){"use strict";function e(e,t){e.state("qq-auth",{needAuth:!1,url:"/qq-auth",title:"QQ登录",controller:"QQAuthController",templateUrl:"modules/qq-auth/qq-auth.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u,l){function d(t){e.cancellingOrder=t,e.showDialog=!0}function p(){e.cancellingOrder=null,e.showDialog=!1}function h(){c.order.cancel({order:e.cancellingOrder.id,reason:1}).then(function(t){e.myOrderModel.reload(),e.cancellingOrder=null,e.showDialog=!1})}function f(e){return e==s.BONUS_STATUS.WAIT?"审核中":e==s.BONUS_STATUS.FINISH?"已分成":e==s.BONUS_STATUS.CANCEL?"已取消":e==s.BONUS_STATUS.REVOKE?"已撤销":""}function g(e){return e==s.BONUS_TYPE.SIGNUP?"注册分成":"订单分成"}function m(){i.go("my-recommend",{})}function v(){i.go("my-balance",{})}function $(){i.go("bonus-rule",{})}e.cancellingOrder=null,e.showDialog=!1,e.bonus_amount=0,e.total_bonus=0,e.myBonusModel=u,e.touchDialogCancel=p,e.touchDialogConfirm=h,e.touchRecommend=m,e.touchMyBalance=v,e.touchRules=$,e.touchCancel=d,e.getBonusStatus=f,e.getBonusType=g,e.myBonusModel.reload()}angular.module("app").controller("BonusController",e),e.$inject=["$scope","$rootScope","$window","$timeout","$location","$state","$stateParams","API","ENUM","BonusModel","ConfigModel"]}(),function(){"use strict";function e(e,t){e.state("bonus",{needAuth:!0,url:"/bonus",title:"我的订单",templateUrl:"modules/bonus/bonus.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){return i.getToken()&&!this.isLoading?(this.bonuses=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p),this.getInfo()):void 0}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.bonuses&&this.bonuses.length?this.fetch(this.bonuses.length/p+1,p):this.fetch(1,p)))}function l(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.bonus.list(o).then(function(e){return n.bonuses=n.bonuses?n.bonuses.concat(e):e,n.isEmpty=!n.bonuses||!n.bonuses.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=e&&e.length<t?!n.isEmpty:!1,!0})}}function d(){if(i.getToken()){var e={},t=this;a.bonus.get(e).then(function(e){return t.bonus_info=e,!0})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.fetch=l,h.getInfo=d,h.reload=s,h.loadMore=u,h.bonuses=[],h}angular.module("app").factory("BonusModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){r.go("balance-history",{})}function u(){r.go("withdraw-history",{})}function l(){e.showDialog=!0}function d(){e.input.withdraw=parseFloat(e.balanceModel.balanceAmount)}function p(){e.showDialog=!1,e.input.memo="",e.input.withdraw=""}function h(){var t=parseFloat(e.input.withdraw);if(isNaN(t))return void e.toast("请输入数字");if(0>=t)return void e.toast("金额不能小于零");if(t>parseFloat(e.balanceModel.balanceAmount))return void e.toast("金额超出提现范围");if(0==e.input.memo.length)return void e.toast("Memo不能为空");var o={};o.cash=t,o.memo=e.input.memo,a.withdraw.submit(o).then(function(t){e.balanceModel.reload(),e.cancellingOrder=null,e.showDialog=!1,r.go("withdraw-success",{withdraw:t.cash,member_memo:t.member_memo})})}e.touchBalanceDetail=s,e.touchWithDrawHistory=u,e.touchWithDraw=l,e.touchDialogCancel=p,e.touchDialogConfirm=h,e.touchWithDrawAll=d,e.balanceModel=c,e.input={withdraw:"",memo:""},e.balanceModel.reload()}angular.module("app").controller("MyBalanceController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","BalanceModel"]}(),function(){"use strict";function e(e,t){e.state("my-balance",{needAuth:!0,url:"/my-balance",title:"可用资金",templateUrl:"modules/my-balance/my-balance.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.getToken()&&(this.isLoading||(this.balances=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,p),this.get()))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.balances&&this.balances.length?this.fetch(this.balances.length/p+1,p):this.fetch(1,p)))}function l(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.balance.list(o).then(function(e){n.balances=n.balances?n.balances.concat(e):e,n.isEmpty=!n.balances||!n.balances.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=e&&e.length<t?!n.isEmpty:!1})}}function d(){if(i.getToken()){var e={},t=this;a.balance.get(e).then(function(e){t.balanceAmount=e})}}var p=10,h={};return h.isEmpty=!1,h.isLoaded=!1,h.isLoading=!1,h.isLastPage=!1,h.fetch=l,h.reload=s,h.get=d,h.loadMore=u,h.balances=[],h.balanceAmount=0,h}angular.module("app").factory("BalanceModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null,e.myBalanceModel.reload())}function d(){e.currentTab!=e.TAB_INCOME&&(e.currentTab=e.TAB_INCOME,e.myBalanceModel.status=s.BALANCE_STATUS.IN,e.myBalanceModel.reload())}function p(){e.currentTab!=e.TAB_EXPENDITURE&&(e.currentTab=e.TAB_EXPENDITURE,e.myBalanceModel.status=s.BALANCE_STATUS.OUT,e.myBalanceModel.reload())}e.TAB_ALL=0,e.TAB_INCOME=1,e.TAB_EXPENDITURE=2,e.currentTab=e.TAB_ALL,e.myBalanceModel=u,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null):"income"==a.tab?(e.currentTab=e.TAB_INCOME,e.myBalanceModel.status=s.BALANCE_STATUS.IN):"expenditure"==a.tab?(e.currentTab=e.TAB_EXPENDITURE,e.myBalanceModel.status=s.BALANCE_STATUS.OUT):(e.currentTab=e.TAB_ALL,e.myBalanceModel.status=null),e.touchTabAll=l,e.touchTabIncome=d,e.touchTabExpenditure=p,e.myBalanceModel.reload()}angular.module("app").controller("BalanceHistoryController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","BalanceModel"]}(),function(){"use strict";function e(e,t){e.state("balance-history",{needAuth:!0,url:"/balance-history",title:"资金明细",templateUrl:"modules/balance-history/balance-history.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){function l(t){e.cancellingWithDraw=t,e.showDialog=!0}function d(){e.cancellingWithDraw=null,e.showDialog=!1}function p(){c.withdraw.cancel({id:e.cancellingWithDraw.id}).then(function(t){e.withDrawHistoryModel.reload(),e.cancellingWithDraw=null,e.showDialog=!1})}e.cancellingWithDraw=null,e.showDialog=!1,e.withDrawHistoryModel=u,e.touchDialogCancel=d,e.touchDialogConfirm=p,e.touchCancel=l,e.withDrawHistoryModel.reload()}angular.module("app").controller("WithDrawHistoryController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","WithDrawHistoryModel"]}(),function(){"use strict";function e(e,t){e.state("withdraw-history",{needAuth:!0,url:"/withdraw-history",title:"提现记录",templateUrl:"modules/withdraw-history/withdraw-history.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.getToken()&&(this.isLoading||(this.withdraws=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,d)))}function u(){i.getToken()&&(this.isLoading||this.isLastPage||(this.withdraws&&this.withdraws.length?this.fetch(this.withdraws.length/d+1,d):this.fetch(1,d)))}function l(e,t){if(i.getToken()){this.isLoading=!0;var o={page:e,per_page:t};null!=this.status&&(o.status=this.status);var n=this;a.withdraw.list(o).then(function(e){n.withdraws=n.withdraws?n.withdraws.concat(e):e,n.isEmpty=!n.withdraws||!n.withdraws.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=e&&e.length<t?!n.isEmpty:!1})}}var d=10,p={};return p.isEmpty=!1,p.isLoaded=!1,p.isLoading=!1,p.isLastPage=!1,p.status=null,p.withdraws=[],p.fetch=l,p.reload=s,p.loadMore=u,p}angular.module("app").factory("WithDrawHistoryModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){e.myRecommendModel=c,e.myRecommendModel.reload()}angular.module("app").controller("MyRecommendController",e),e.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","MyRecommendModel"]}(),function(){"use strict";function e(e,t){e.state("my-recommend",{needAuth:!0,url:"/my-recommend",title:"可用资金",templateUrl:"modules/my-recommend/my-recommend.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c){function s(){i.getToken()&&this.fetch()}function u(){if(i.getToken()){var e=this,t={};a.recommend.bonusInfo(t).then(function(t){e.bonus_info=t})}}var l={};return l.reload=s,l.fetch=u,l}angular.module("app").factory("MyRecommendModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}(),function(){"use strict";function e(e,t,o,n,r){e.withdraw=r.withdraw,e.member_memo=r.member_memo}angular.module("app").controller("WithDrawSuccessController",e),e.$inject=["$scope","$http","$location","$state","$stateParams"]}(),function(){"use strict";function e(e,t){e.state("withdraw-success",{needAuth:!0,url:"/withdraw-success?withdraw&member_memo",title:"提现成功",templateUrl:"modules/withdraw-success/withdraw-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o,n,r,i,a,c,s,u){e.bonusModel=c,e.bonusModel.bonus_info&&(e.rule_desc=u.trustAsHtml(e.bonusModel.bonus_info.rule_desc)),s.bonus.get().then(function(t){e.rule_desc=u.trustAsHtml(t.rule_desc)})}angular.module("app").controller("BonusRuleController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","BonusModel","API","$sce"]}(),function(){"use strict";function e(e,t){e.state("bonus-rule",{needAuth:!1,url:"/bonus-rule",title:"分成规则",controller:"BonusRuleController",templateUrl:"modules/bonus-rule/bonus-rule.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();