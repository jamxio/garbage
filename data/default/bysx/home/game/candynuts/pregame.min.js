function importScript(a) {
    var b = document.createElement("script");
    b.src = "src/" + a, document.head.appendChild(b)
}
function extend(a, b) {
    var c = function () {
    };
    c.prototype = b.prototype, a.prototype = new c, a.prototype.constructor = a, a.superclass = b.prototype
}
function dragAndDrop(a) {
    var b, c;
    a.addEventListener("mousedown", function (a) {
        b = a.stageX - a.target.x, c = a.stageY - a.target.y
    }), a.addEventListener("pressmove", function (a) {
        a.target.x = a.stageX - b, a.target.y = a.stageY - c
    }), a.addEventListener("pressup", function (a) {
        console.log(a.target.x, a.target.y)
    })
}
function indexOf(a, b) {
    for (var c = -1, d = 0; d < a.length; d++)a[d] == b && (c = d);
    return c
}
function distXY(a, b, c, d) {
    return Math.sqrt((c - a) * (c - a) + (d - b) * (d - b))
}
function round(a) {
    return Math.round(100 * a) / 100
}
function radToDeg(a) {
    return 180 * a / Math.PI
}
function circlesColliding(a, b, c, d, e, f) {
    var g = d - a, h = e - b, i = c + f;
    return i * i > g * g + h * h ? !0 : !1
}
function div(a, b) {
    return (a - a % b) / b
}
function ResizeGame() {
    window.scrollTo(0, 1);
    var a = WIDTHGAME, b = HEIGHTGAME, c = __WIDTHBG - a, d = __HEIGHTBG - b, e = __WIDTHBG - d, f = __HEIGHTBG - c, g = window.innerWidth / window.innerHeight, h = __WIDTHBG / (f - d), i = document.getElementById("gameArea"), j = document.getElementById("imgl2p"), k = document.getElementById("background"), l = document.getElementById("gameField");
    void 0 != window.orientation && (g > 1 ? (k.style.display = "none", l.style.display = "none", j.style.display = "table-cell") : (k.style.display = "block", l.style.display = "block", j.style.display = "none")), g > h ? (i.style.height = __HEIGHTBG * window.innerHeight / (f - d) + "px", i.style.width = __WIDTHBG * window.innerHeight / (f - d) + "px", i.style.left = window.innerWidth / 2 - __WIDTHBG * window.innerHeight / (f - d) / 2 + "px", i.style.top = -(d / 2) * window.innerHeight / (f - d) + "px") : (i.style.height = f * window.innerWidth / __WIDTHBG + "px", i.style.width = e * window.innerWidth / e + "px", i.style.top = window.innerHeight / 2 - __HEIGHTBG * window.innerWidth / __WIDTHBG / 2 + "px", i.style.left = "0px")
}
function addToTicker(a) {
    var b = indexOf(mas, a);
    -1 == b ? mas.push(a) : mas[b] = a
}
function delInTicker(a) {
    var b = indexOf(mas, a);
    -1 != b && mas.splice(b, 1)
}
function startTicker() {
    timerOFF = !1, __time = setInterval(function () {
        if (!timerOFF)for (var a = 0; a < mas.length; a++)mas[a]()
    }, 1e3 / __freq)
}
function stopTicker() {
    timerOFF = !0
}
function removeAllTimers() {
    mas = new Array
}
function delayOn(a, b, c) {
    var d = 0, e = function () {
        return d > __freq * a ? (delInTicker(e), void(b && b.apply(null, c))) : void d++
    };
    mas.push(e)
}
function Preloader() {
    this.initialize();
    var a = new ProgressBar("JSON1", "progress", "progress", 0, 0, .5);
    setCoor(a, 132, 371);
    var b = new FontText(goal, "Center");
    setCoor(b, 320, 320), b.setText("0%"), this.addChild(a), this.addChild(b), this.setLvl = function (c) {
        if (b.setText(Math.round(100 * c) + "%"), 100 * c > 12.5) {
            var d = div(100 * c, 12.5);
            a.setLvl(12.5 * d)
        }
    }
}
function FontText(a, b) {
    this.initialize();
    var c, d = new Array, e = 30 / __koefDisplay;
    b && (c = b), this.setText = function (b, f) {
        if (f || this.removeAllChildren(), "string" == typeof b || "number" == typeof b) {
            for (var g = new createjs.Container, h = b.toString(), i = 0, j = f ? a.lineHeight * (f - 1) : 0, k = 0; k < h.length; k++) {
                d[k] = new createjs.Sprite(new createjs.SpriteSheet(a.ss_font)), d[k].gotoAndStop("f" + h[k]), d[k].x = i, d[k].y = j, g.addChild(d[k]);
                for (var l = 0; l < a.kerning.length; l++)if (a.kerning[l][0] == h[k] && !a.kerning[l][1]) {
                    e = a.kerning[l][2];
                    break
                }
                (h.length - (k + 1)) % 3 == 0 && k + 1 != h.length && "number" == typeof b && (e = 1.5 * e), i += e
            }
            g.x = 0, "Center" == c && (g.x = -i / 2), this.addChild(g)
        } else {
            f = 1;
            for (var l = 0; l < b.length; l++)this.setText(b[l], f), f++
        }
    }, this.setText(0)
}
function ProgressBar(a, b, c, d, e, f) {
    this.initialize();
    var g, h;
    a ? (b && (h = jsons[a + __disSuffiks] ? new createjs.Sprite(jsons[a + __disSuffiks]) : new createjs.Bitmap(images[b]), h.gotoAndStop && h.gotoAndStop(b), f && (h.alpha = f), this.addChild(h)), g = jsons[a + __disSuffiks] ? new createjs.Sprite(jsons[a + __disSuffiks]) : new createjs.Bitmap(images[c]), g.gotoAndStop && g.gotoAndStop(c), this.addChild(g)) : (g = c, h = b), g.x = "number" == typeof d ? d / __koefDisplay : h.getBounds().width / __koefDisplay / 2 - g.getBounds().width / __koefDisplay / 2, g.y = "number" == typeof e ? e / __koefDisplay : h.getBounds().height / __koefDisplay / 2 - g.getBounds().height / __koefDisplay / 2;
    var i = g.getBounds().width, j = new createjs.Shape;
    j.graphics.beginFill("#000000").drawRect(0, 0, i, this.getBounds().height), setCoor(j, -i + g.x), j.x = -i + g.x, g.mask = j, this.setLvl = function (a) {
        a > 100 && (a = 100);
        var b = i * a / 100;
        j.x = -i + g.x + b
    }, this.gotoLvl = function (a, b) {
        a > 100 && (a = 100);
        var c = i * a / 100;
        TweenTo(j, round(-i + g.x + c), j.y, null, b)
    }
}
function startPreloader() {
    return __stageBG = document.getElementById(canvases.bg), __arrBG[bgImgs[0].name] = createBgImg(bgImgs[0].url), __stageBG.appendChild(__arrBG[bgImgs[0].name]), __stageGame = createStage(canvases.game, 0, (__HEIGHTBG - HEIGHTGAME) / 2), __arrLoc.preloader = new Preloader, addToTicker(function () {
        __stageGame.update()
    }), choiseLocation("preloader"), __arrLoc.preloader
}
function initLocations() {
    for (var a, b = 1; b < bgImgs.length; b++)__arrBG[bgImgs[b].name] = createBgImg(bgImgs[b].url), __stageBG.appendChild(__arrBG[bgImgs[b].name]);
    __arrLoc.game = new Game, __arrLoc.menu = new Menu, __arrLoc.lvlctrl = new LvlCtrl, __arrLoc.instruction = new Instructions, __arrLoc.setting = new Setting, __arrLoc.about = new About, __arrLoc.splash = new SplashScreen, a = new Modal, __arrLoc.pause = new Pause(a, __arrLoc.game), a = new Modal, __arrLoc.complete = new LvlComplete(a, __arrLoc.game), a = new Modal, __arrLoc.gameover = new GameOver(a, __arrLoc.game), console.log()
}
function choiseLocation(a, b, c, d) {
    if (__arrLoc[a]) {
        updateBg("game" == a ? bgImgs[1].name : "lvlctrl" == a ? bgImgs[2].name : "preloader" == a ? bgImgs[0].name : bgImgs[3].name);
        var e = b ? b.dontUpd : null;
        if (__arrLoc[a].update && !e && __arrLoc[a].update(b), "setting" == a || "about" == a || d) {
            __stageGame.addChild(__arrLoc[a]);
            var f = function (b) {
                b != __arrLoc[a] ? __stageGame.removeChild(b) : c && c()
            };
            __arrLoc[a].x = -__WIDTHBG;
            for (var g = 0; g < __stageGame.getNumChildren(); g++) {
                var h = __stageGame.getChildAt(g);
                TweenTo(h, h.x + __WIDTHBG, h.y, .5, f, [h])
            }
        } else __stageGame.removeAllChildren(), __stageGame.addChild(__arrLoc[a]), "preloader" != a && removeTween(__arrLoc[a]), __arrLoc[a].x = 0;
        return __arrLoc[a]
    }
}
function setCoor(a, b, c) {
    "number" == typeof b && (a.x = b / __koefDisplay), "number" == typeof c && (a.y = c / __koefDisplay)
}
var mas = new Array, __freq = 60, __time;
extend(Preloader, createjs.Container), extend(FontText, createjs.Container), extend(ProgressBar, createjs.Container);
var __stageGame, __stageBG, __arrBG = new Array, __arrLoc = new Array, updateBg = function (a) {
    for (var b = 0; b < bgImgs.length; b++)__arrBG[bgImgs[b].name] && __arrBG[bgImgs[b].name].parentNode && __stageBG.removeChild(__arrBG[bgImgs[b].name]);
    __stageBG.appendChild(__arrBG[a])
}, createStage = function (a, b, c) {
    canvasInit(a);
    var d = document.getElementById(a), e = new createjs.Stage(d);
    return createjs.Touch.enable(e), e.x = b, e.y = c, e
}, createBgImg = function (a) {
    var b;
    return images[a] ? b = images[a] : (b = document.createElement("div"), b.style.background = "linear-gradient(to bottom, #b7d3a7 0%, #e1e2b1 50%, #b7d3a7 100%)", b.style.width = "100%", b.style.height = "100%"), b.id = "bg", b
}, canvasInit = function (a) {
    var b = document.getElementById(a);
    b.width = __WIDTHBG, b.height = __HEIGHTBG
};
bgImgs = [{name: "other", url: null}, {name: "game", url: "img_game_bg"}, {
    name: "lvlctrl",
    url: "img_lvlctrl_bg"
}, {
    name: "windows",
    url: "img_windows_bg"
}], __WIDTHBG = 640 / __koefDisplay, __HEIGHTBG = 960 / __koefDisplay, WIDTHGAME = 640 / __koefDisplay, HEIGHTGAME = 744 / __koefDisplay, canvases = {
    game: "gameField",
    bg: "background"
};
var _allMusic = new Array, _obsMusic = new Array, onoff = new Array, __curMusic;
MusicCTRL = {
    start: function (a) {
        for (var b = a.target._loadQueueBackup, c = 0; c < b.length; c++)b[c]._item.type == createjs.LoadQueue.SOUND && (_allMusic[b[c]._item.id] = createjs.Sound.createInstance(b[c]._item.id))
    }, on: function (a, b) {
        b || (b = -1), 1 == b ? b = null : b--, _allMusic[a] && (onoff[a] = {open: !0, loop: b});
        for (var c = 1; _allMusic[a + c];)onoff[a + c] = {open: !0, loop: b}, c++;
        for (var d = 0; d < _obsMusic.length; d++)_obsMusic[d].on && _obsMusic[d].on(a);
        __curMusic = !0
    }, off: function (a) {
        _allMusic[a] && (_allMusic[a].stop(), onoff[a] = {open: !1});
        for (var b = 1; _allMusic[a + b];)_allMusic[a + b].stop(), onoff[a + b] = {open: !1}, b++;
        for (var c = 0; c < _obsMusic.length; c++)_obsMusic[c].off && _obsMusic[c].off(a);
        __curMusic = !1
    }, play: function (a) {
        if (onoff[a] && onoff[a].open) {
            var b;
            b = onoff[a].loop ? {loop: onoff[a].loop} : null, _allMusic[a].play(b)
        }
    }, registerObserver: function (a) {
        _obsMusic.push(a)
    }
};